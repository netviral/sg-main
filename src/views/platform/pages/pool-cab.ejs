<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>SG Platform</title>
  <link rel="shortcut icon" type="image/png" href="/platform/assets/images/logos/favicon.png" />
  <!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous"> -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>

  <link rel="stylesheet" href="/platform/assets/css/styles.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <link href="https://fonts.gstatic.com" rel="preconnect" />
  <link rel="stylesheet" href="/platform/assets/css/dataTables.css" />
  <link
    href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Nunito:300,300i,400,400i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i"
    rel="stylesheet">
  <style>
    @media screen and (max-width: 768px) {
      .scroll {
        display: block;
        overflow-x: auto;
      }
      .upper {
        margin-bottom: 5px;
      }
    }
  </style>
  <%-include("../partials/preloader-css")%>
  <%-include("../partials/preloader-js")%>

</head>
<%-include("../partials/post-head")%>

<script>
    function capitalizeFirstLetter(string) {
    return string.charAt(0).toUpperCase() + string.slice(1);
}
</script>

<body>
  <!--  Body Wrapper -->
  <%-include("../partials/preloader")%>
  <div class="page-wrapper" id="main-wrapper" data-layout="vertical" data-navbarbg="skin6" data-sidebartype="full"
    data-sidebar-position="fixed" data-header-position="fixed">
    <%-include("../partials/sidebar")%>
    <!--  Main wrapper -->
    <div class="body-wrapper">
      <%-include("../partials/header")%>
      <div class="container-fluid">
        <div class="container-fluid">
          <div class="row justify-content-between">
            <div class="card">
              <div class="card-body">
                <div class="row">
                  <div class="col-md-12">
                    <div class="flex-row mb-2">
                      <span class="fs-6 fw-semibold">Pool a Cab</span>
                    </div>
                    <div class="flex-row mb-3">
                      <ul class="list-inline">
                        <span style="font-size: 10px;" class="fs-3 fw-semibold">
                          Below is the list of all people using the service. Please find a person closest to your arrival time and route, and reach out to them using their contact details. Please make sure that they're avaiable for pooling under the status bar before contacting them.
                        </span>                                         
                      </ul>
                    </div>
                    <br>
                    <!-- <table class="inputs">
                      <tbody>
                        <tr>
                          <td>Filter by Semester:</td>
                          <td><input type="text" id="sem" name="sem"></td>
                        </tr>
                        <tr>
                          <td>Filter by Year:</td>
                          <td><input type="text" id="max" name="max"></td>
                        </tr>
                      </tbody>
                    </table> -->
                    <form>
                      <div class="row">
                        <div class="col-lg-6">
                          <select class="form-select" id="day" name="day">
                            <option  selected>Filter by Day</option>
                            <option value = "Jan 19">Jan 19</option>
                            <option value = "Jan 20">Jan 20</option>
                            <option value = "Jan 21">Jan 21</option>
                          </select>
                        </div>
                        <div class="col-lg-6">
                          <select class="form-select" id="route" name="route">
                            <option selected>Filter by Route</option>
                            <option value="Airport to Campus">Airport to Campus</option>
                            <option value="Airport to Jahangirpuri">Airport to Jahangirpuri</option>
                            <option value="Jahangirpuri to Campus">Jahangirpuri to Campus</option>
                            <option value="New Delhi to Campus">New Delhi to Campus</option>
                            <option value="New Delhi to Jahangirpuri">New Delhi to Jahangirpuri</option>
                          </select>
                        </div>
                      </div>
                    </form>
                    <br />
                    <table id="pool" class="table table-striped scroll" style="width:100%">
                      <thead>
                          <tr>
                              <th></th>
                              <th>Name</th>
                              <th>Contact</th>
                              <th>Time</th>
                              <th>Route</th>
                              <th>Day</th>
                              <th>Status</th>
                          </tr>
                      </thead>
                      <tbody>
                        <%for(i=0;i<pools.length;i++){%>
                          <%if(pools[i].attributes.status == 'available'){%>
                            <tr>
                              <td><span style="padding-left: 4px; font-size: x-small; color: #6EC531;"><i class="fa fa-circle"></i></span></td>
                              <td><%=pools[i].attributes.pooler.data.attributes.username%></td>
                              <td><%=pools[i].attributes.pooler.data.attributes.phone%></td>
                              <td><%=new Date('1970-01-01T' + pools[i].attributes.time).toLocaleTimeString('en-US', { hour12: true }) %></td>
                              <td>
                                <%=pools[i].attributes.journey.replace(/\b(?:(?!to)\w)/g, match => match.toUpperCase())%>
                              </td>
                              <td>
                                <%let date = new Date(pools[i].attributes.day);%>
                                <%date = date.toString();%>
                                <%date = date.slice(3,10);%>
                                <%=date%>
                              </td>
                              <td><%=pools[i].attributes.status.charAt(0).toUpperCase() + pools[i].attributes.status.slice(1)%></td>
                            </tr>
                          <%} else if(pools[i].attributes.status == 'pooled'){%>
                            <tr style="opacity:0.5;">
                              <td><span style="padding-left: 4px; font-size: x-small; color: gray;"><i class="fa fa-circle"></i></span></td>
                              <td><%=pools[i].attributes.pooler.data.attributes.username%></td>
                              <td><%=pools[i].attributes.pooler.data.attributes.phone%></td>
                              <td><%=new Date('1970-01-01T' + pools[i].attributes.time).toLocaleTimeString('en-US', { hour12: true }) %>
                                </td>
                              <td>
                                <%let route = pools[i].attributes.journey;%>
                                <%let temp = route.split(" ");%>
                                <%temp[0] = temp[0].charAt(0).toUpperCase() + temp[0].slice(1);%>
                                <%temp[2] = temp[2].charAt(0).toUpperCase() + temp[2].slice(1);%>
                                <%route = temp.join(" ");%>
                                <%=route%>
                              </td>
                              <td>
                                <%let date = new Date(pools[i].attributes.day);%>
                                <%date = date.toString();%>
                                <%date = date.slice(3,10);%>
                                <%=date%>
                              </td>
                              <td><%=pools[i].attributes.status.charAt(0).toUpperCase() + pools[i].attributes.status.slice(1)%></td>
                            </tr>
                          <%}%>
                        <%}%>                      
                      </tbody>
                      <tfoot>
                          <tr>
                              <th></th>
                              <th>Name</th>
                              <th>Contact</th>
                              <th>Time</th>
                              <th>Route</th>
                              <th>Day</th>
                              <th>Status</th>
                          </tr>
                      </tfoot>
                  </table>
                    </div>
                  </div>
                </div>
              </div>
              <div class="card">
                <div class="card-body">
                  <div class="row">
                    <div class="col-md-12">
                      <div class="flex-row mb-2">
                        <span class="fs-6 fw-semibold">Trip Details:</span>
                      </div>
                      <div class="flex-row mb-3">
                        <ul class="list-inline">
                          <span style="font-size: 10px;" class="fs-3 fw-semibold">
                            If you found a person to pool a cab with, or wish to change your estimated time of arrival then please use the below section to update your details so that others can contact you for the right trips                           
                          </span>                                         
                        </ul>
                      </div>
                      <br>
                      <form action="/platform/update-pool" method="POST">
                        <div class="row">
                          <div class="col-md-6">
                            <div class="mb-3">
                              <label class="form-label">Date</label>
                              <%let user_date = new Date(user_detail.day);%>
                              <%user_date = user_date.toString();%>
                              <%user_date = user_date.slice(3,10);%>
                              <input disabled class="form-control" type="text" value="<%=user_date%>">
                            </div>
                          </div>
                          <div class="col-md-6">
                            <div class="mb-3">
                              <label class="form-label">Route</label>
                              <input disabled class="form-control" type="text" value="<%=user_detail.journey.replace(/\b(?:(?!to)\w)/g, match => match.toUpperCase())%>">
                            </div>
                          </div>
                        </div>
                        <div class="row">
                          <div class="col-md-6">
                            <div class="mb-3">
                              <label class="form-label">Time</label>
                              <input class="form-control" name="time" type="time" value="<%=user_detail.time.substr(0, user_detail.time.lastIndexOf(':'))%>">
                              <input class="form-control" name="pool_id" type="hidden" value="<%-btoa(user_detail.id)%>">
                            </div>
                          </div>
                          <div class="col-md-6">
                            <div class="mb-3">
                              <label class="form-label">Status</label>
                              <select class="form-select" id="status" name="status" aria-placeholder="<%=user_detail.status.charAt(0).toUpperCase() + user_detail.status.slice(1)%>">
                                <option value="available" <%= user_detail.status === 'available' ? 'selected' : '' %>>Available</option>
                                <option value="pooled" <%= user_detail.status === 'pooled' ? 'selected' : '' %>>Pooled</option>                              
                              </select>
                            </div>
                          </div>
                        </div>
                        <br>
                        <div class="row" style="float: right;">
                          <div style="text-align: center;" class="col-md-12">
                            <button type="submit" class="btn btn-primary upper">Update My Details</button>
                            <button disabled onclick="window.location.href=`https://forms.gle/VdWrAC4PB9CQamDq9`" class="btn btn-danger">Cancel My Request</button>
                          </div>
                        </div>
                      </form>
                      <br />
                      
                      </div>
                    </div>
                  </div>
                </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  </div>
  <script src="/platform/assets/libs/jquery/dist/jquery.min.js"></script>
  <script src="/platform/assets/libs/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
  <script src="/platform/assets/js/sidebarmenu.js"></script>
  <script src="/platform/assets/js/app.min.js"></script>
  <script src="/platform/assets/libs/apexcharts/dist/apexcharts.min.js"></script>
  <script src="/platform/assets/libs/simplebar/dist/simplebar.js"></script>
  <script src="/platform/assets/js/dashboard.js"></script>
  <script src="/platform/assets/js/theme.js"></script>
  <script src="/platform/assets/js/main.js"></script>
  <!-- <script src="https://code.jquery.com/jquery-3.7.0.js"></script> -->
  <script src="/platform/assets/js/dataTables.js"></script>
  <!-- <script src="https://cdn.datatables.net/1.13.7/js/dataTables.bootstrap4.min.js"></script> -->
  <script>
    const dayEl = document.querySelector('#day');
    const routeEl = document.querySelector('#route');
    
    // Custom range filtering function
    DataTable.ext.search.push(function (settings, data, dataIndex) {
        let day = dayEl.value;
        let route = routeEl.value;
        let daydata = (data[5]) || 0;
        let routedata = (data[4]) || 0;
        // console.log(year);
        if (
            (day == "Filter by Day" && route == "Filter by Route") ||
            (daydata.includes(day) && route == "Filter by Route") ||
            (day == "Filter by Day" && routedata.includes(route)) ||
            (daydata.includes(day) && routedata.includes(route))
        ) {
            // console.log(sem)
            return true;
        }
    
        return false;
    });
    
    const table = new DataTable('#pool');
    
    // Changes to the inputs will trigger a redraw to update the table
    dayEl.addEventListener('change', function () {
        table.draw();
    });
    routeEl.addEventListener('change', function () {
        table.draw();
    });
  </script>
  <!-- <%-include("../partials/preloader-js")%> -->
</body>

</html>