<div class="container mt-5">
  <h1 class="mb-4">Clubs and Societies Catalogue</h1>

  <!-- Filter Section -->
  <div id="filter-section" class="mb-4">
    <h3>Filter by Topic</h3>
    <form id="filter-form" class="form-inline">
      <div>
        <label><input type="checkbox" name="topics" value="sports"> Sports</label>
      </div>
      <div>
        <label><input type="checkbox" name="topics" value="arts"> Arts</label>
      </div>
      <div>
        <label><input type="checkbox" name="topics" value="science"> Science</label>
      </div>
      <div>
        <label><input type="checkbox" name="topics" value="music"> Music</label>
      </div>
      <button type="button" id="apply-filters" class="btn btn-primary mt-3">Apply Filters</button>
    </form>
  </div>

  <!-- Search Section -->
  <div id="search-section" class="mb-4">
    <h3>Search by Name</h3>
    <input type="text" id="search-bar" class="form-control" placeholder="type to search...">
  </div>

  <div id="results-section">
    <ul id="results-list" class="list-group">
      <% clubs.forEach(club => { %>
        <li 
          data-name="<%= club.name %>" 
          data-topics="<%= club.topics.join(', ') %>" 
          class="list-group-item organisation-item">
          <a href="/clubs-socs-catalogue/<%= club.id %>"><%= club.name %></a>
        </li>
      <% }); %>
      <% societies.forEach(society => { %>
        <li 
          data-name="<%= society.name %>" 
          data-topics="<%= society.topics.join(', ') %>" 
          class="list-group-item organisation-item">
          <a href="/clubs-socs-catalogue/<%= society.id %>"><%= society.name %></a>
        </li>
      <% }); %>
    </ul>
  </div>
</div>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const applyFiltersButton = document.getElementById("apply-filters");
    const organisationItems = document.querySelectorAll(".organisation-item");
    const searchBar = document.getElementById("search-bar");

    applyFiltersButton.addEventListener("click", () => {
      const selectedFilters = Array.from(document.querySelectorAll('input[name="topics"]:checked'))
        .map(input => input.value);

      organisationItems.forEach(item => {
        const itemTopics = item.getAttribute("data-topics").split(", ");
        const matches = selectedFilters.some(filter => itemTopics.includes(filter));

        if (selectedFilters.length === 0 || matches) {
          item.style.display = "list-item";
        } else {
          item.style.display = "none";
        }
      });
    });

    searchBar.addEventListener("input", () => {
      const searchQuery = searchBar.value.toLowerCase();
      organisationItems.forEach(item => {
        const itemName = item.getAttribute("data-name").toLowerCase();

        if (itemName.startsWith(searchQuery)) {
          item.style.display = "list-item";
        } else {
          item.style.display = "none";
        }
      });
    });
  });
</script>
